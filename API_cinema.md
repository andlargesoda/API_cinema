# Спецификация API кинотеатра
## Содержание

- [Спецификация API кинотеатра](#спецификация-api-кинотеатра)
  - [Содержание](#содержание)
  - [Контекст задания](#контекст-задания)
    - [Задание 1](#задание-1)
    - [Задание 2](#задание-2)
  - [Решение](#решение)
    - [Решение 1](#решение-1)
      - [1. Структура хранения данных](#1-структура-хранения-данных)
      - [2. Взаимодействие с API](#2-взаимодействие-с-api)
      - [3. Действия API](#3-действия-api)
      - [4. HTTP методы API](#4-http-методы-api)
      - [5. Ресурсы API](#5-ресурсы-api)
      - [6. Параметры запросов и ответов для методов HTTP](#6-параметры-запросов-и-ответов-для-методов-http)
    - [Решение 2](#решение-2)

## Контекст задания

Кинотеатр “Искорка” показывает фильмы для детей и подростков. 

Кинотеатр имеет онлайн расписание, а также продает билеты на свои сеансы онлайн через систему бронирования. 

Информация о забронированных билетах вносится в базу бронирования, с указанием данных покупателя.

Все данные о сеансах и бронировании хранятся и обрабатываются на одном сервере.

Требуется автоматизировать решение следующих задач:
* Узнать наличие мест на сеанс
* Забронировать место
* Отменить бронь
* Изменить время сеанса (администратором кинотеатра)

Так как система построена на микросервисной архитектуре - для решения задачи нужно спроектировать API.
### Задание 1
Подготовьте данные для проектирования API, отвечая на вопросы ниже:
1.	Описать структуру хранения данных (по примеру ниже):

|Имя|Тип|Описание поля (для проверяющих)|
|:--|:--|:------------------------------|
|(заполнить)|(заполнить)|(заполнить)|

2.	Кто будет взаимодействовать с API
3.	Какие действия будет выполнять API
4.	Какие HTTP методы будет использовать API
5.	К каким ресурсам будет обращаться API
6.	Какие параметры запроса будут передаваться в каждый из методов?
7.	Какие параметры ответа будут в методах?

### Задание 2

Спроектировать и описать API для решения задач выше. Использовать данные, подготовленные в задании 1. Для подготовки документации использовать нотацию Open API и инструмент https://app.swaggerhub.com/home или https://editor.swagger.io/

Описать разделы:

* Info;
* Servers;
* Paths, включая подразделы Parameters, Responses.

## Решение

### Решение 1

#### 1. Структура хранения данных

1.	брони/bookings

Информация о забронированных местах

| Имя                  | Тип                                     | Описание поля                        |
|----------------------|-----------------------------------------|--------------------------------------|
| bookingID            | integer                                 | идентификатор бронирования           |
| userID               | integer                                 | ссылка на идентификатор пользователя |
| sessionID            | integer                                 | ссылка на идентификатор сеанса       |
| bookingDateTime      | string (format: DateTime)               | дата и время бронирования            |
| numberTicketsBooked  | integer                                 | кол-во забронированных билетов       |
| totalCostBooking     | string (format: Money)                  | общая стоимость бронирования         |
| status               | String: enum (“confirmed”, “canceled”)  | статус                               |

2.	фильмы/movies

Информация о фильмах

| Имя                  | Тип                                     | Описание поля                        |
|----------------------|-----------------------------------------|--------------------------------------|
| movieID              | integer                                 | идентификатор фильма                 |
| genre                | string                                  | жанр                                 |
| countryProduction    | string                                  | страна производства                  |
| yearProduction       | string (format: Year)                   | год выхода                           |
| releaseDate          | string (format: Date)                   | дата выхода                          |
| ageRating            | String: enum (“6+”, “12+”,”16+”, “18+”) | возрастной рейтинг                   |
| duration             | integer                                 | продолжительность, мин               |
| plot                 | string                                  | сюжет                                |

3.	cеансы/sessions

Информация о сеансах

| Имя                  | Тип                                     | Описание поля                        |
|----------------------|-----------------------------------------|--------------------------------------|
| sessionID            | integer                                 | идентификатор сеанса                 |
| movieID              | integer                                 | ссылка на идентификатор фильма       |
| hallID               | Integer                                 | ссылка на идентификатор зала         |
| sessionDate          | string (format: Date)                   | дата сеанса                          |
| sessionStartTime     | string (format: Time)                   | время начала сеанса                  |
| sessionEndTime       | string (format: Time)                   | время конца сеанса                   |
| sessionFormat        | String: enum (“2D”, “3D”)               | формат сеанса                        |
| numberAvailableSeats | integer                                 | количество свободных мест            |
| numberSelectedSeats  | integer                                 | количество выбранных мест            |
| numberOccupiedSeats  | integer                                 | количество занятых мест              |

4.	пользователи/users

Информация о пользователях

| Имя                  | Тип                                     | Описание поля                        |
|----------------------|-----------------------------------------|--------------------------------------|
| userID               | integer                                 | идентификатор пользователя           |
| userName             | string (format: Name)                   | ФИО пользователя                     |
| dateOfBirth          | string (format: Date)                   | дата рождения                        |
| phone                | string (format: phone)                  | телефон                              |
| email                | string (format: email)                  | email                                |

5.	залы/halls

Информация о залах кинотеатра

| Имя                  | Тип                                     | Описание поля                            |
|----------------------|-----------------------------------------|------------------------------------------|
| hallID               | integer                                 | идентификатор зала                       |
| hallName             | string (format: Name)                   | название зала                            |
| capacity             | string (format: Date)                   | количество мест                          |
| hallType             | string (enum: IMAX, VIP, Standart)      | тип зала (список: IMAX, VIP, Стандартный)|

6.	места/seats

Информация о местах в зале кинотеатра

| Имя        | Тип                                              | Описание поля                                          |
|------------|--------------------------------------------------|--------------------------------------------------------|
| seatID     | integer                                          | ссылка на идентификатор меcта                          |
| hallID     | integer                                          | идентификатор зала                                     |
| rowNumber  | integer                                          | номер ряда                                             |
| seatNumber | integer                                          | номер места                                            |
| seatType   | string, (enum: chair, sofa, disabledPersonChair) | тип места (список: кресло, диван, место для инвалидов) |
| seatPrice  | string (format: Money)                           | стоимость места                                        |

7.	занятые места/occupiedSeats

Связь между бронями и местами

| Имя              | Тип     | Описание поля                        |
|------------------|---------|--------------------------------------|
| occupiedSeats ID | integer | идентификатор занятого места         |
| bookingID        | integer | ссылка на идентификатор бронирования |
| seatID           | integer | ссылка на идентификатор места        |

#### 2. Взаимодействие с API

Взаимодействовать с API будут:
* Покупатели (пользователи, клиенты кинотеатра)-просмотр расписания и наличия мест на сеанс, бронирование, отмена брони.
* Администраторы кинотеатра-управление сеансами (изменение времени).

#### 3. Действия API

* проверить доступные места;
* забронировать место;
* отменить бронь;
* изменить время сеанса (администратор).

#### 4. HTTP методы API

* GET-проверить доступные места;
* POST-забронировать место;
* DELETE-отменить бронь;
* PATCH-изменить время сеанса (администратор).

#### 5. Ресурсы API

* GET/sessions{sessionID}/seats;
* POST/bookings;
* DELETE/bookings{bookingID};
* PATCH/sessions{sessionID}.

#### 6. Параметры запросов и ответов для методов HTTP

**1. GET/sessions{sessionID}/seats**

| Параметры запроса| Тело запроса     | Параметры ответа                     |
|------------------|------------------|--------------------------------------|
| sessionID        | -                | sessionID                            |
| -                | -                | movieID                              |
| -                | -                | hallID                               |
| -                | -                | sessionDate                          |
| -                | -                | sessionStartTime                     |
| -                | -                | sessionEndTime                       |
| -                | -                | sessionFormat                        |
| -                | -                | numberAvailableSeats                 |
| -                | -                | numberSelectedSeats                  |
| -                | -                | numberOccupiedSeats                  |
  
**2. POST/booking**
   
| Параметры запроса| Тело запроса     | Параметры ответа                     |
|------------------|------------------|--------------------------------------|
| -                | sessionsID       | bookingID                            |
| -                | seatID           | userID                               |
| -                | userID           | sessionID                            |
| -                | -                | bookingDateTime                      |
| -                | -                | numberTicketsBooked                  |
| -                | -                | totalCostBooking                     |
| -                | -                | status                               |
  
**3. DELETE/booking{bookingID}**

| Параметры запроса| Тело запроса     | Параметры ответа                     |
|------------------|------------------|--------------------------------------|
| bookingID        | -                | status                               |
  
**4. PATCH/sessions{sessionID}/sessionTime**

| Параметры запроса| Тело запроса     | Параметры ответа                     |
|------------------|------------------|--------------------------------------|
| sessionID        | sessionDate      | sessionID                            |
| -                | sessionStartTime | movieID                              |
| -                | -                | hallID                               |
| -                | -                | sessionDate                          |
| -                | -                | sessionStartTime                     |
| -                | -                | sessionEndTime                       |
| -                | -                | sessionFormat                        |
| -                | -                | numberAvailableSeats                 |
| -                | -                | numberSelectedSeats                  |
| -                | -                | numberOccupiedSeats                  |

### Решение 2

Спецификация OpenAPI, сформированная при помощи Swagger приведена по ссылке:
[Спецификация OpenAPI](https://github.com/andlargesoda/API_cinema/blob/main/API_cinema_v1.0.1.yml)